<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Employee Reviews</title>
<style>
body{font-family:Roboto,Arial,sans-serif;margin:0;padding:0;background:#fafafa;color:#333;}
nav{display:flex;gap:10px;background:#6200ee;color:white;padding:10px;}
nav button{background:none;border:none;color:white;font-size:16px;cursor:pointer;padding:6px 12px;}
section{padding:20px;}
.card{background:white;padding:15px;margin-bottom:10px;border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.2);} 
.hidden{display:none;}
label{display:block;margin-top:10px;}
input[type=text],textarea{width:100%;padding:8px;margin-top:4px;border:1px solid #ccc;border-radius:4px;}
select{padding:8px;}
button.primary{background:#6200ee;color:white;border:none;border-radius:4px;padding:8px 16px;cursor:pointer;}
</style>
<script>
let user=null,config={},lang=localStorage.getItem('lang')||'en';
const translations={
  en:{home:'Home',schedule:'Schedule',welcomeTitle:'Welcome to the Employee Review Portal',welcomeMsg:'Select an option from the navigation bar to view your reviews or schedule a meeting. Use the language button to switch between English and Spanish.',comingSoon:'Coming soon...',email:'Email',password:'Password',login:'Login',loginFail:'login fail'},
  es:{home:'Inicio',schedule:'Agenda',welcomeTitle:'Bienvenido al Portal de Evaluaciones',welcomeMsg:'Seleccione una opción en la barra de navegación para ver sus evaluaciones o programar una reunión. Use el botón de idioma para cambiar entre inglés y español.',comingSoon:'Próximamente...',email:'Correo electrónico',password:'Contraseña',login:'Iniciar sesión',loginFail:'Error al iniciar sesión'}
};
function t(key){
  if(config[key]&&config[key][lang])return config[key][lang];
  if(translations[lang]&&translations[lang][key])return translations[lang][key];
  return key;
}
function show(id){document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');}
function applyTranslations(){
  document.querySelectorAll('[data-i18n]').forEach(el=>{el.textContent=t(el.dataset.i18n);});
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{el.placeholder=t(el.dataset.i18nPlaceholder);});
  document.getElementById('langBtn').textContent=lang.toUpperCase();
}
function init(){
  show('home');
  applyTranslations();
  google.script.run.withSuccessHandler(c=>{config=c;loadSession();}).loadConfig();
}
function loadSession(){
  google.script.run.withSuccessHandler(u=>{
    if(u){
      user=u;
      lang=u.lang;
      localStorage.setItem('lang',lang);
      applyTranslations();
      loadReviews();
      show('home');
    }else{
      document.getElementById('login').classList.remove('hidden');
      applyTranslations();
    }
  }).getSession();
}
function login(){
  const e=document.getElementById('email').value;
  const p=document.getElementById('pw').value;
  google.script.run.withSuccessHandler(r=>{
    if(r.success){
      user=r.user;
      lang=user.lang;
      localStorage.setItem('lang',lang);
      document.getElementById('login').classList.add('hidden');
      applyTranslations();
      loadReviews();
      show('home');
    }else{
      alert(t('loginFail'));
    }
  }).login(e,p);
}
function saveLang(){lang=lang==='en'?'es':'en';google.script.run.saveLang(lang);localStorage.setItem('lang',lang);applyTranslations();renderReviews();}
let reviews=[];
function loadReviews(){google.script.run.withSuccessHandler(r=>{reviews=r;renderReviews();}).listReviews();}
function renderReviews(){const c=document.getElementById('reviews');c.innerHTML='';reviews.forEach(rv=>{const div=document.createElement('div');div.className='card';div.innerHTML='<b>'+rv.type+'</b> '+rv.status+'<br>'+JSON.stringify(rv.data);c.appendChild(div);});}
document.addEventListener('DOMContentLoaded',init);
</script>
</head>
<body>
<nav>
<button onclick="show('home')" data-i18n="home">Home</button>
<button onclick="show('schedule')" data-i18n="schedule">Schedule</button>
<button id="langBtn" onclick="saveLang()">EN</button>
</nav>
<section id="home" class="hidden">
<h2 data-i18n="welcomeTitle">Welcome to the Employee Review Portal</h2>
<p data-i18n="welcomeMsg">Select an option from the navigation bar to view your reviews or schedule a meeting. Use the language button to switch between English and Spanish.</p>
<div id="reviews"></div>
</section>
<section id="schedule" class="hidden">
<p data-i18n="comingSoon">Coming soon...</p>
</section>
<div id="login" class="hidden">
<label><span data-i18n="email">Email</span><input type="text" id="email" data-i18n-placeholder="email"></label>
<label><span data-i18n="password">Password</span><input type="password" id="pw" data-i18n-placeholder="password"></label>
<button class="primary" onclick="login()" data-i18n="login">Login</button>
</div>
</body>
</html>
